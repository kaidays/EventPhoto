<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>カメラフレーム撮影</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: black;
    height: 100%;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
  }
  video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: 0;
  }
  canvas {
    display: none;
  }
  .frame {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    transform: translate(-50%, -50%);
    object-fit: contain;
    pointer-events: none;
    z-index: 1;
  }
  .controls {
    position: absolute;
    bottom: 50px;
    width: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2;
  }
  .shutter-btn {
    width: 80px;
    height: 80px;
    background: white;
    border-radius: 50%;
    border: 5px solid #ccc;
    cursor: pointer;
  }
  .switch-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(255,255,255,0.7);
    border: none;
    border-radius: 5px;
    padding: 10px;
    font-size: 16px;
    cursor: pointer;
    z-index: 3;
  }
</style>
</head>
<body>
  <video id="video" autoplay playsinline></video>
  <img id="frame" class="frame" src="frame1.png">
  <button class="switch-btn" id="switchBtn">フレーム切替</button>
  <div class="controls">
    <div class="shutter-btn" id="shutterBtn"></div>
  </div>
  <canvas id="canvas" width="1080" height="1920"></canvas>
<script>
let currentFrame = 1;
const video = document.getElementById('video');
const frame = document.getElementById('frame');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const shutterBtn = document.getElementById('shutterBtn');
const switchBtn = document.getElementById('switchBtn');

navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } })
  .then(stream => {
    video.srcObject = stream;
  })
  .catch(err => {
    alert("カメラが使用できません: " + err);
  });

switchBtn.addEventListener('click', () => {
  currentFrame = currentFrame === 1 ? 2 : 1;
  frame.src = currentFrame === 1 ? "frame1.png" : "frame2.png";
});

shutterBtn.addEventListener('click', () => {
  ctx.fillStyle = "black";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  const videoRatio = video.videoWidth / video.videoHeight;
  const targetRatio = canvas.width / canvas.height;
  let drawWidth, drawHeight, offsetX, offsetY;

  if (videoRatio > targetRatio) {
    drawHeight = canvas.height;
    drawWidth = video.videoWidth * (canvas.height / video.videoHeight);
    offsetX = (canvas.width - drawWidth) / 2;
    offsetY = 0;
  } else {
    drawWidth = canvas.width;
    drawHeight = video.videoHeight * (canvas.width / video.videoWidth);
    offsetX = 0;
    offsetY = (canvas.height - drawHeight) / 2;
  }

  ctx.drawImage(video, offsetX, offsetY, drawWidth, drawHeight);

  const img = new Image();
  img.src = frame.src;
  img.onload = () => {
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    const link = document.createElement('a');
    link.download = 'photo.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  };
});
</script>
</body>
</html>