<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ•ã‚©ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ã‚«ãƒ¡ãƒ©</title>
<style>
  body { margin:0; text-align:center; background:#000; color:white; font-family:sans-serif; }
  video, canvas { max-width: 100%; height: auto; }
  #controls { margin: 10px 0; }
  button { padding:10px 20px; margin:5px; font-size:16px; }
  #framePreview { position:absolute; top:0; left:0; pointer-events:none; }
  #cameraWrapper { position: relative; display:inline-block; }
</style>
</head>
<body>

<h2>ãƒ•ã‚©ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ã‚«ãƒ¡ãƒ©</h2>

<div id="controls">
  <button onclick="setFrame(0)">ãƒ•ãƒ¬ãƒ¼ãƒ 1</button>
  <button onclick="setFrame(1)">ãƒ•ãƒ¬ãƒ¼ãƒ 2</button>
  <button onclick="takePhoto()">ğŸ“¸ æ’®å½±</button>
</div>

<div id="cameraWrapper">
  <video id="video" autoplay playsinline></video>
  <img id="framePreview" src="frame1.png">
</div>

<br><br>
<canvas id="canvas" style="display:none;"></canvas>
<a id="downloadLink" download="framed-photo.png" style="display:none;">ç”»åƒã‚’ä¿å­˜</a>

<script>
const video = document.getElementById('video');
const framePreview = document.getElementById('framePreview');
const canvas = document.getElementById('canvas');
const downloadLink = document.getElementById('downloadLink');

const frameImages = ["frame1.png", "frame2.png"];
let currentFrameIndex = 0;
let frameImageObj = new Image();
frameImageObj.src = frameImages[0];

// ã‚«ãƒ¡ãƒ©èµ·å‹•
async function startCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: 'environment' }
    });
    video.srcObject = stream;
  } catch (err) {
    alert("ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã§ãã¾ã›ã‚“: " + err);
  }
}

// ãƒ•ãƒ¬ãƒ¼ãƒ åˆ‡æ›¿
function setFrame(index) {
  currentFrameIndex = index;
  framePreview.src = frameImages[index];
  frameImageObj.src = frameImages[index];
}

// æ’®å½±
function takePhoto() {
  frameImageObj.onload = () => {
    // ãƒ•ãƒ¬ãƒ¼ãƒ ã‚µã‚¤ã‚ºã‚’åŸºæº–ã«Canvasä½œæˆ
    const w = frameImageObj.width;
    const h = frameImageObj.height;
    canvas.width = w;
    canvas.height = h;

    const ctx = canvas.getContext('2d');

    // ã‚«ãƒ¡ãƒ©æ˜ åƒã‚’ãƒ•ãƒ¬ãƒ¼ãƒ ã‚µã‚¤ã‚ºã«åˆã‚ã›ã¦æç”»
    ctx.drawImage(video, 0, 0, w, h);

    // ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’é‡ã­ã‚‹
    ctx.drawImage(frameImageObj, 0, 0, w, h);

    // ä¿å­˜ãƒªãƒ³ã‚¯è¨­å®š
    const dataURL = canvas.toDataURL('image/png');
    downloadLink.href = dataURL;
    downloadLink.style.display = 'inline-block';
    downloadLink.textContent = "ç”»åƒã‚’ä¿å­˜";
  };
}

startCamera();
</script>

</body>
</html>